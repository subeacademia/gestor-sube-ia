<div class="admin-container">
  <app-header></app-header>

  <main class="admin-main">
    <div class="stats-section">
      <div class="stat-card">
        <h3>Total Contratos</h3>
        <p>{{ totalContratos }}</p>
      </div>
      <div class="stat-card">
        <h3>Pendientes de Firma</h3>
        <p>{{ contratosPendientes }}</p>
      </div>
      <div class="stat-card">
        <h3>Firmados</h3>
        <p>{{ contratosFirmados }}</p>
      </div>
      <div class="stat-card">
        <h3>Valor Total</h3>
        <p>{{ valorTotalContratos | currency:'CLP':'symbol':'1.0-0' }}</p>
      </div>
    </div>

    <div class="filters-section">
      <div class="search-group">
        <label for="buscador-contratos">üîç Buscar contratos:</label>
        <input 
          type="text" 
          id="buscador-contratos" 
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()"
          placeholder="Buscar por c√≥digo, cliente, empresa..." 
          class="search-input">
      </div>
      <div class="filter-group">
        <label for="filtro-estado-contrato">Filtrar por estado:</label>
        <select id="filtro-estado-contrato" [(ngModel)]="filtroEstado" (change)="aplicarFiltros()">
          <option value="todos">Todos los estados</option>
          <option value="Pendiente de Firma">Pendiente de Firma</option>
          <option value="Enviado">Enviado</option>
          <option value="Firmado">Firmado</option>
          <option value="Finalizado">Finalizado</option>
        </select>
      </div>
      <button (click)="aplicarFiltros()" class="btn btn-filter">Aplicar Filtros</button>
      <button (click)="mostrarModalCrearContrato()" class="btn btn-primary">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
        </svg>
        Crear Contrato Directo
      </button>
    </div>

    <div class="cotizaciones-section">
      <h2>üìã Tablero de Contratos</h2>
      
      <!-- Tablero Kanban -->
      <div class="kanban-board">
        <!-- Columna: Pendiente de Firma -->
        <div class="kanban-column">
          <div class="kanban-column-header">
            <h3>‚è≥ Pendiente de Firma</h3>
            <span class="column-count">{{ getContratosPorEstado('Pendiente de Firma').length }}</span>
          </div>
          <div class="kanban-column-content">
            <app-contract-card 
              *ngFor="let contrato of getContratosPorEstado('Pendiente de Firma')"
              [contrato]="contrato"
              (estadoChanged)="onEstadoChanged($event)"
              (contratoDeleted)="onContratoDeleted($event)">
            </app-contract-card>
          </div>
        </div>
        
        <!-- Columna: Enviado -->
        <div class="kanban-column">
          <div class="kanban-column-header">
            <h3>üì§ Enviado</h3>
            <span class="column-count">{{ getContratosPorEstado('Enviado').length }}</span>
          </div>
          <div class="kanban-column-content">
            <app-contract-card 
              *ngFor="let contrato of getContratosPorEstado('Enviado')"
              [contrato]="contrato"
              (estadoChanged)="onEstadoChanged($event)"
              (contratoDeleted)="onContratoDeleted($event)">
            </app-contract-card>
          </div>
        </div>
        
        <!-- Columna: Firmado -->
        <div class="kanban-column">
          <div class="kanban-column-header">
            <h3>‚úÖ Firmado</h3>
            <span class="column-count">{{ getContratosPorEstado('Firmado').length }}</span>
          </div>
          <div class="kanban-column-content">
            <app-contract-card 
              *ngFor="let contrato of getContratosPorEstado('Firmado')"
              [contrato]="contrato"
              (estadoChanged)="onEstadoChanged($event)"
              (contratoDeleted)="onContratoDeleted($event)">
            </app-contract-card>
          </div>
        </div>
        
        <!-- Columna: Finalizado -->
        <div class="kanban-column">
          <div class="kanban-column-header">
            <h3>üéâ Finalizado</h3>
            <span class="column-count">{{ getContratosPorEstado('Finalizado').length }}</span>
          </div>
          <div class="kanban-column-content">
            <app-contract-card 
              *ngFor="let contrato of getContratosPorEstado('Finalizado')"
              [contrato]="contrato"
              (estadoChanged)="onEstadoChanged($event)"
              (contratoDeleted)="onContratoDeleted($event)">
            </app-contract-card>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>

<!-- Modal para crear contrato directo -->
<div class="modal" [class]="{ 'modal-show': mostrarModal }" (click)="cerrarModal()">
  <div class="modal-content modal-contrato-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Crear Contrato Directo</h3>
      <span class="close" (click)="cerrarModal()">&times;</span>
    </div>
    <div class="modal-body">
      <div class="form-row">
        <div class="form-group">
          <label for="titulo-contrato-directo">T√≠tulo del Contrato:</label>
          <input type="text" id="titulo-contrato-directo" [(ngModel)]="nuevoContrato.titulo" class="form-input" placeholder="Ej: Contrato de Servicios de Consultor√≠a">
        </div>
        <div class="form-group">
          <label for="fecha-inicio-directo">Fecha de Inicio:</label>
          <input type="date" id="fecha-inicio-directo" [(ngModel)]="nuevoContrato.fechaInicio" class="form-input">
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label for="fecha-fin-directo">Fecha de Fin (opcional):</label>
          <input type="date" id="fecha-fin-directo" [(ngModel)]="nuevoContrato.fechaFin" class="form-input">
        </div>
        <div class="form-group">
          <label for="valor-total-directo">Valor Total del Contrato:</label>
          <input type="number" id="valor-total-directo" [(ngModel)]="nuevoContrato.valorTotal" class="form-input" placeholder="0">
        </div>
      </div>

      <div class="form-group">
        <label for="nombre-cliente-directo">Nombre del Cliente:</label>
        <input type="text" id="nombre-cliente-directo" [(ngModel)]="nuevoContrato.nombreCliente" class="form-input" placeholder="Nombre completo del cliente">
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="email-cliente-directo">Email del Cliente:</label>
          <input type="email" id="email-cliente-directo" [(ngModel)]="nuevoContrato.emailCliente" class="form-input" placeholder="email@ejemplo.com">
        </div>
        <div class="form-group">
          <label for="rut-cliente-directo">RUT del Cliente:</label>
          <input type="text" id="rut-cliente-directo" [(ngModel)]="nuevoContrato.rutCliente" class="form-input" placeholder="12.345.678-9">
        </div>
      </div>

      <div class="form-group">
        <label for="empresa-cliente-directo">Empresa:</label>
        <input type="text" id="empresa-cliente-directo" [(ngModel)]="nuevoContrato.empresa" class="form-input" placeholder="Nombre de la empresa">
      </div>

      <div class="form-group">
        <label for="servicios-contrato-directo">Descripci√≥n de Servicios:</label>
        <textarea id="servicios-contrato-directo" [(ngModel)]="nuevoContrato.descripcionServicios" class="form-textarea" rows="4" placeholder="Describe los servicios que se prestar√°n..."></textarea>
      </div>

      <div class="form-group">
        <label for="terminos-contrato-directo">T√©rminos y Condiciones:</label>
        <textarea id="terminos-contrato-directo" [(ngModel)]="nuevoContrato.terminosCondiciones" class="form-textarea" rows="6" placeholder="Ingrese los t√©rminos y condiciones del contrato..."></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button (click)="cerrarModal()" class="btn btn-secondary">Cancelar</button>
      <button (click)="guardarContratoDirecto()" class="btn btn-primary">Guardar Contrato</button>
    </div>
  </div>
</div>
