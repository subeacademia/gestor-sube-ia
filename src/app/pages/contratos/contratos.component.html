<div class="admin-container">
  <!-- Header -->
  <app-header (logoutEvent)="onLogout()"></app-header>

  <main class="admin-main">
    <!-- Sección de Estadísticas -->
    <div class="stats-section">
      <app-stat-card 
        *ngFor="let stat of stats" 
        [title]="stat.title" 
        [value]="stat.value">
      </app-stat-card>
    </div>

    <!-- Sección de Filtros -->
    <div class="filters-section">
      <div class="search-group">
        <label for="buscador-contratos">🔍 Buscar contratos:</label>
        <input 
          type="text" 
          id="buscador-contratos" 
          [(ngModel)]="searchTerm"
          (input)="aplicarFiltros()"
          placeholder="Buscar por código, cliente, empresa..." 
          class="search-input">
      </div>

      <div class="filter-group">
        <label for="filtro-estado-contrato">Filtrar por estado:</label>
        <select 
          id="filtro-estado-contrato" 
          [(ngModel)]="filtroEstado"
          (change)="aplicarFiltros()">
          <option value="todos">Todos los estados</option>
          <option value="Pendiente de Firma">Pendiente de Firma</option>
          <option value="Enviado">Enviado</option>
          <option value="Firmado">Firmado</option>
          <option value="Finalizado">Finalizado</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="filtro-mes-contrato">Filtrar por mes:</label>
        <select 
          id="filtro-mes-contrato" 
          [(ngModel)]="filtroMes"
          (change)="aplicarFiltros()">
          <option value="todos">Todos los meses</option>
          <option value="1">Enero</option>
          <option value="2">Febrero</option>
          <option value="3">Marzo</option>
          <option value="4">Abril</option>
          <option value="5">Mayo</option>
          <option value="6">Junio</option>
          <option value="7">Julio</option>
          <option value="8">Agosto</option>
          <option value="9">Septiembre</option>
          <option value="10">Octubre</option>
          <option value="11">Noviembre</option>
          <option value="12">Diciembre</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="filtro-ano-contrato">Filtrar por año:</label>
        <select 
          id="filtro-ano-contrato" 
          [(ngModel)]="filtroAno"
          (change)="aplicarFiltros()">
          <option value="todos">Todos los años</option>
          <option value="2024">2024</option>
          <option value="2023">2023</option>
          <option value="2022">2022</option>
        </select>
      </div>

      <button class="btn btn-filter" (click)="aplicarFiltros()">
        🔍 Aplicar Filtros
      </button>
    </div>

    <!-- Sección de Contratos -->
    <div class="contratos-section">
      <div class="section-header">
        <h2>📋 Tablero de Contratos</h2>
        <div class="header-buttons">
          <button class="btn btn-secondary" (click)="crearContratoPrueba()">
            🧪 Crear Contrato de Prueba
          </button>
          <button class="btn btn-info" (click)="cargarContratos()">
            🔄 Recargar Contratos
          </button>
          <button class="btn btn-warning" (click)="verificarCargaContratos()">
            🔍 Verificar Carga
          </button>
          <button class="btn btn-primary" (click)="mostrarModalCrearContrato()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
            </svg>
            Crear Contrato Directo
          </button>
        </div>
      </div>

      <!-- Tablero Kanban -->
      <div class="kanban-board" *ngIf="!cargando && contratosFiltrados.length > 0">
        <!-- Columna: Pendiente de Firma -->
        <div class="kanban-column">
          <div class="kanban-column-header">
            <h3>⏳ Pendiente de Firma</h3>
            <span class="column-count">{{ getContratosPorEstado('Pendiente de Firma').length }}</span>
          </div>
          <div class="kanban-column-content">
            <app-contract-card 
              *ngFor="let contrato of getContratosPorEstado('Pendiente de Firma')"
              [contrato]="contrato"
              (verContrato)="onVerContrato($event)"
              (editarContrato)="onEditarContrato($event)"
              (eliminarContrato)="onEliminarContrato($event)"
              (cambiarEstado)="onCambiarEstado($event)"
              (enviarFirma)="onEnviarFirma($event)"
              (generarPDF)="onGenerarPDF($event)">
            </app-contract-card>
          </div>
        </div>
        
        <!-- Columna: Enviado -->
        <div class="kanban-column">
          <div class="kanban-column-header">
            <h3>📤 Enviado</h3>
            <span class="column-count">{{ getContratosPorEstado('Enviado').length }}</span>
          </div>
          <div class="kanban-column-content">
            <app-contract-card 
              *ngFor="let contrato of getContratosPorEstado('Enviado')"
              [contrato]="contrato"
              (verContrato)="onVerContrato($event)"
              (editarContrato)="onEditarContrato($event)"
              (eliminarContrato)="onEliminarContrato($event)"
              (cambiarEstado)="onCambiarEstado($event)"
              (enviarFirma)="onEnviarFirma($event)"
              (generarPDF)="onGenerarPDF($event)">
            </app-contract-card>
          </div>
        </div>
        
        <!-- Columna: Firmado -->
        <div class="kanban-column">
          <div class="kanban-column-header">
            <h3>✅ Firmado</h3>
            <span class="column-count">{{ getContratosPorEstado('Firmado').length }}</span>
          </div>
          <div class="kanban-column-content">
            <app-contract-card 
              *ngFor="let contrato of getContratosPorEstado('Firmado')"
              [contrato]="contrato"
              (verContrato)="onVerContrato($event)"
              (editarContrato)="onEditarContrato($event)"
              (eliminarContrato)="onEliminarContrato($event)"
              (cambiarEstado)="onCambiarEstado($event)"
              (enviarFirma)="onEnviarFirma($event)"
              (generarPDF)="onGenerarPDF($event)">
            </app-contract-card>
          </div>
        </div>
        
        <!-- Columna: Finalizado -->
        <div class="kanban-column">
          <div class="kanban-column-header">
            <h3>🎉 Finalizado</h3>
            <span class="column-count">{{ getContratosPorEstado('Finalizado').length }}</span>
          </div>
          <div class="kanban-column-content">
            <app-contract-card 
              *ngFor="let contrato of getContratosPorEstado('Finalizado')"
              [contrato]="contrato"
              (verContrato)="onVerContrato($event)"
              (editarContrato)="onEditarContrato($event)"
              (eliminarContrato)="onEliminarContrato($event)"
              (cambiarEstado)="onCambiarEstado($event)"
              (enviarFirma)="onEnviarFirma($event)"
              (generarPDF)="onGenerarPDF($event)">
            </app-contract-card>
          </div>
        </div>
      </div>

      <!-- Vista de lista tradicional (cuando no hay contratos o está cargando) -->
      <div class="contratos-list" *ngIf="cargando || contratosFiltrados.length === 0">
        <div *ngIf="cargando" class="loading-container">
          <div class="loading-spinner">⏳</div>
          <p>Cargando contratos...</p>
        </div>

        <div *ngIf="!cargando && contratosFiltrados.length === 0" class="no-data">
          <div class="empty-icon">📄</div>
          <p>No se encontraron contratos con los filtros aplicados</p>
          <p class="empty-subtitle">Los contratos aparecerán aquí una vez que se creen</p>
        </div>
      </div>
    </div>
  </main>
</div>
