<div class="admin-container">
  <app-header></app-header>

  <main class="admin-main">
    <div class="stats-section">
      <div class="stat-card">
        <div class="stat-icon">ğŸ“Š</div>
        <div class="stat-content">
          <h3>Total Cotizaciones</h3>
          <p>{{ totalCotizaciones }}</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ“…</div>
        <div class="stat-content">
          <h3>Este Mes</h3>
          <p>{{ cotizacionesMes }}</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">ğŸ’°</div>
        <div class="stat-content">
          <h3>Valor Total</h3>
          <p>{{ valorTotal | currency:'CLP':'symbol':'1.0-0' }}</p>
        </div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">âœ…</div>
        <div class="stat-content">
          <h3>Total Aceptado</h3>
          <p>{{ totalAceptadas | currency:'CLP':'symbol':'1.0-0' }}</p>
        </div>
      </div>
    </div>

    <div class="filters-section">
      <div class="search-group">
        <label for="buscador">ğŸ” Buscar en tiempo real:</label>
        <input 
          type="text" 
          id="buscador" 
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()"
          placeholder="Buscar por cÃ³digo, nombre, empresa, email, atendido..." 
          class="search-input">
      </div>
      <div class="filter-group">
        <label for="filtro-fecha">ğŸ“… Filtrar por fecha:</label>
        <select id="filtro-fecha" [(ngModel)]="filtroFecha" (change)="aplicarFiltros()">
          <option value="todos">Todos</option>
          <option value="hoy">Hoy</option>
          <option value="semana">Esta semana</option>
          <option value="mes">Este mes</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="filtro-atendedor">ğŸ‘¤ Filtrar por atendido:</label>
        <select id="filtro-atendedor" [(ngModel)]="filtroAtendedor" (change)="aplicarFiltros()">
          <option value="todos">Todos</option>
          <option value="Rodrigo Carrillo">Rodrigo Carrillo</option>
          <option value="Bruno Villalobos">Bruno Villalobos</option>
          <option value="Mario MuÃ±oz">Mario MuÃ±oz</option>
          <option value="NicolÃ¡s Valenzuela">NicolÃ¡s Valenzuela</option>
          <option value="Ignacio Villarroel">Ignacio Villarroel</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="filtro-estado">ğŸ·ï¸ Filtrar por estado:</label>
        <select id="filtro-estado" [(ngModel)]="filtroEstado" (change)="aplicarFiltros()">
          <option value="todos">Todos los estados</option>
          <option value="Emitida">Emitida</option>
          <option value="Contestada">Contestada</option>
          <option value="En NegociaciÃ³n">En NegociaciÃ³n</option>
          <option value="Aceptada">Aceptada</option>
          <option value="Rechazada">Rechazada</option>
        </select>
      </div>
      <button (click)="aplicarFiltros()" class="btn btn-filter">
        <span class="btn-icon">ğŸ”</span>
        Aplicar Filtros
      </button>
    </div>

    <div class="cotizaciones-section">
      <div class="section-header">
        <h2>ğŸ“‹ Tablero de Cotizaciones</h2>
        <div class="view-toggle">
          <button 
            class="view-btn active" 
            (click)="setViewMode('kanban')"
            [class.active]="viewMode === 'kanban'">
            ğŸ“Š Kanban
          </button>
          <button 
            class="view-btn" 
            (click)="setViewMode('list')"
            [class.active]="viewMode === 'list'">
            ğŸ“ Lista
          </button>
        </div>
      </div>
      
      <!-- Vista Kanban -->
      <div class="kanban-board" *ngIf="viewMode === 'kanban'">
        <!-- Columna: Emitida -->
        <div class="kanban-column" 
             [class.column-emitida]="true"
             (dragover)="onDragOver($event)"
             (drop)="onDrop($event, 'Emitida')">
          <div class="kanban-column-header">
            <div class="column-icon">ğŸ“„</div>
            <div class="column-info">
              <h3>Emitida</h3>
              <span class="column-count">{{ getCotizacionesPorEstado('Emitida').length }}</span>
            </div>
          </div>
          <div class="kanban-column-content">
            <app-quote-card 
              *ngFor="let cotizacion of getCotizacionesPorEstado('Emitida')"
              [cotizacion]="cotizacion"
              [draggable]="true"
              (dragstart)="onDragStart($event, cotizacion)"
              (estadoChanged)="onEstadoChanged($event)"
              (cotizacionDeleted)="onCotizacionDeleted($event)">
            </app-quote-card>
            <div class="empty-state" *ngIf="getCotizacionesPorEstado('Emitida').length === 0">
              <div class="empty-icon">ğŸ“„</div>
              <p>Sin cotizaciones emitidas</p>
            </div>
          </div>
        </div>
        
        <!-- Columna: Contestada -->
        <div class="kanban-column" 
             [class.column-contestada]="true"
             (dragover)="onDragOver($event)"
             (drop)="onDrop($event, 'Contestada')">
          <div class="kanban-column-header">
            <div class="column-icon">ğŸ’¬</div>
            <div class="column-info">
              <h3>Contestada</h3>
              <span class="column-count">{{ getCotizacionesPorEstado('Contestada').length }}</span>
            </div>
          </div>
          <div class="kanban-column-content">
            <app-quote-card 
              *ngFor="let cotizacion of getCotizacionesPorEstado('Contestada')"
              [cotizacion]="cotizacion"
              [draggable]="true"
              (dragstart)="onDragStart($event, cotizacion)"
              (estadoChanged)="onEstadoChanged($event)"
              (cotizacionDeleted)="onCotizacionDeleted($event)">
            </app-quote-card>
            <div class="empty-state" *ngIf="getCotizacionesPorEstado('Contestada').length === 0">
              <div class="empty-icon">ğŸ’¬</div>
              <p>Sin cotizaciones contestadas</p>
            </div>
          </div>
        </div>
        
        <!-- Columna: En NegociaciÃ³n -->
        <div class="kanban-column" 
             [class.column-negociacion]="true"
             (dragover)="onDragOver($event)"
             (drop)="onDrop($event, 'En NegociaciÃ³n')">
          <div class="kanban-column-header">
            <div class="column-icon">ğŸ¤</div>
            <div class="column-info">
              <h3>En NegociaciÃ³n</h3>
              <span class="column-count">{{ getCotizacionesPorEstado('En NegociaciÃ³n').length }}</span>
            </div>
          </div>
          <div class="kanban-column-content">
            <app-quote-card 
              *ngFor="let cotizacion of getCotizacionesPorEstado('En NegociaciÃ³n')"
              [cotizacion]="cotizacion"
              [draggable]="true"
              (dragstart)="onDragStart($event, cotizacion)"
              (estadoChanged)="onEstadoChanged($event)"
              (cotizacionDeleted)="onCotizacionDeleted($event)">
            </app-quote-card>
            <div class="empty-state" *ngIf="getCotizacionesPorEstado('En NegociaciÃ³n').length === 0">
              <div class="empty-icon">ğŸ¤</div>
              <p>Sin cotizaciones en negociaciÃ³n</p>
            </div>
          </div>
        </div>
        
        <!-- Columna: Aceptada -->
        <div class="kanban-column" 
             [class.column-aceptada]="true"
             (dragover)="onDragOver($event)"
             (drop)="onDrop($event, 'Aceptada')">
          <div class="kanban-column-header">
            <div class="column-icon">âœ…</div>
            <div class="column-info">
              <h3>Aceptada</h3>
              <span class="column-count">{{ getCotizacionesPorEstado('Aceptada').length }}</span>
            </div>
          </div>
          <div class="kanban-column-content">
            <app-quote-card 
              *ngFor="let cotizacion of getCotizacionesPorEstado('Aceptada')"
              [cotizacion]="cotizacion"
              [draggable]="true"
              (dragstart)="onDragStart($event, cotizacion)"
              (estadoChanged)="onEstadoChanged($event)"
              (cotizacionDeleted)="onCotizacionDeleted($event)">
            </app-quote-card>
            <div class="empty-state" *ngIf="getCotizacionesPorEstado('Aceptada').length === 0">
              <div class="empty-icon">âœ…</div>
              <p>Sin cotizaciones aceptadas</p>
            </div>
          </div>
        </div>
        
        <!-- Columna: Rechazada -->
        <div class="kanban-column" 
             [class.column-rechazada]="true"
             (dragover)="onDragOver($event)"
             (drop)="onDrop($event, 'Rechazada')">
          <div class="kanban-column-header">
            <div class="column-icon">âŒ</div>
            <div class="column-info">
              <h3>Rechazada</h3>
              <span class="column-count">{{ getCotizacionesPorEstado('Rechazada').length }}</span>
            </div>
          </div>
          <div class="kanban-column-content">
            <app-quote-card 
              *ngFor="let cotizacion of getCotizacionesPorEstado('Rechazada')"
              [cotizacion]="cotizacion"
              [draggable]="true"
              (dragstart)="onDragStart($event, cotizacion)"
              (estadoChanged)="onEstadoChanged($event)"
              (cotizacionDeleted)="onCotizacionDeleted($event)">
            </app-quote-card>
            <div class="empty-state" *ngIf="getCotizacionesPorEstado('Rechazada').length === 0">
              <div class="empty-icon">âŒ</div>
              <p>Sin cotizaciones rechazadas</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Vista Lista -->
      <div class="list-view" *ngIf="viewMode === 'list'">
        <div class="list-header">
          <div class="list-column">CÃ³digo</div>
          <div class="list-column">Cliente</div>
          <div class="list-column">Empresa</div>
          <div class="list-column">Total</div>
          <div class="list-column">Estado</div>
          <div class="list-column">Fecha</div>
          <div class="list-column">Acciones</div>
        </div>
        <div class="list-item" *ngFor="let cotizacion of cotizacionesFiltradas">
          <div class="list-column">{{ cotizacion.codigo }}</div>
          <div class="list-column">{{ cotizacion.nombre }}</div>
          <div class="list-column">{{ cotizacion.empresa }}</div>
          <div class="list-column">{{ formatCurrency(cotizacion.valor) }}</div>
          <div class="list-column">
            <span class="status-badge" [class]="'status-' + cotizacion.estado.toLowerCase().replace(' ', '-')">
              {{ cotizacion.estado }}
            </span>
          </div>
          <div class="list-column">{{ formatDate(cotizacion.fecha) }}</div>
          <div class="list-column">
            <div class="list-actions">
              <button class="btn-action btn-info" (click)="verPDF(cotizacion)" title="Ver PDF">ğŸ“„</button>
              <button class="btn-action btn-success" (click)="generarContrato(cotizacion)" title="Generar Contrato">ğŸ“‹</button>
              <button class="btn-action btn-warning" (click)="editarCotizacion(cotizacion)" title="Editar">âœï¸</button>
              <button class="btn-action btn-danger" (click)="eliminarCotizacion(cotizacion)" title="Eliminar">ğŸ—‘ï¸</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
