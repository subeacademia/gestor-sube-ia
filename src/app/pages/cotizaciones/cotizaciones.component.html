<div class="admin-container">
  <app-header></app-header>

  <main class="admin-main">
    <div class="stats-section">
      <div class="stat-card">
        <h3>Total Cotizaciones</h3>
        <p>{{ totalCotizaciones }}</p>
      </div>
      <div class="stat-card">
        <h3>Este Mes</h3>
        <p>{{ cotizacionesMes }}</p>
      </div>
      <div class="stat-card">
        <h3>Valor Total</h3>
        <p>{{ valorTotal | currency:'CLP':'symbol':'1.0-0' }}</p>
      </div>
      <div class="stat-card">
        <h3>Total Aceptado</h3>
        <p>{{ totalAceptadas | currency:'CLP':'symbol':'1.0-0' }}</p>
      </div>
    </div>

    <div class="filters-section">
      <div class="search-group">
        <label for="buscador">üîç Buscar en tiempo real:</label>
        <input 
          type="text" 
          id="buscador" 
          [(ngModel)]="searchTerm"
          (input)="onSearchChange()"
          placeholder="Buscar por c√≥digo, nombre, empresa, email, atendido..." 
          class="search-input">
      </div>
      <div class="filter-group">
        <label for="filtro-fecha">Filtrar por fecha:</label>
        <select id="filtro-fecha" [(ngModel)]="filtroFecha" (change)="aplicarFiltros()">
          <option value="todos">Todos</option>
          <option value="hoy">Hoy</option>
          <option value="semana">Esta semana</option>
          <option value="mes">Este mes</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="filtro-atendedor">Filtrar por atendido:</label>
        <select id="filtro-atendedor" [(ngModel)]="filtroAtendedor" (change)="aplicarFiltros()">
          <option value="todos">Todos</option>
          <option value="Rodrigo Carrillo">Rodrigo Carrillo</option>
          <option value="Bruno Villalobos">Bruno Villalobos</option>
          <option value="Mario Mu√±oz">Mario Mu√±oz</option>
          <option value="Nicol√°s Valenzuela">Nicol√°s Valenzuela</option>
          <option value="Ignacio Villarroel">Ignacio Villarroel</option>
        </select>
      </div>
      <div class="filter-group">
        <label for="filtro-estado">Filtrar por estado:</label>
        <select id="filtro-estado" [(ngModel)]="filtroEstado" (change)="aplicarFiltros()">
          <option value="todos">Todos los estados</option>
          <option value="Emitida">Emitida</option>
          <option value="Contestada">Contestada</option>
          <option value="En Negociaci√≥n">En Negociaci√≥n</option>
          <option value="Aceptada">Aceptada</option>
          <option value="Rechazada">Rechazada</option>
        </select>
      </div>
      <button (click)="aplicarFiltros()" class="btn btn-filter">Aplicar Filtros</button>
    </div>

    <div class="cotizaciones-section">
      <h2>üìã Tablero de Cotizaciones</h2>
      
      <!-- Tablero Kanban -->
      <div class="kanban-board">
        <!-- Columna: Emitida -->
        <div class="kanban-column">
          <div class="kanban-column-header">
            <h3>üìÑ Emitida</h3>
            <span class="column-count">{{ getCotizacionesPorEstado('Emitida').length }}</span>
          </div>
          <div class="kanban-column-content">
            <app-quote-card 
              *ngFor="let cotizacion of getCotizacionesPorEstado('Emitida')"
              [cotizacion]="cotizacion"
              (estadoChanged)="onEstadoChanged($event)"
              (cotizacionDeleted)="onCotizacionDeleted($event)">
            </app-quote-card>
          </div>
        </div>
        
        <!-- Columna: Contestada -->
        <div class="kanban-column">
          <div class="kanban-column-header">
            <h3>üí¨ Contestada</h3>
            <span class="column-count">{{ getCotizacionesPorEstado('Contestada').length }}</span>
          </div>
          <div class="kanban-column-content">
            <app-quote-card 
              *ngFor="let cotizacion of getCotizacionesPorEstado('Contestada')"
              [cotizacion]="cotizacion"
              (estadoChanged)="onEstadoChanged($event)"
              (cotizacionDeleted)="onCotizacionDeleted($event)">
            </app-quote-card>
          </div>
        </div>
        
        <!-- Columna: En Negociaci√≥n -->
        <div class="kanban-column">
          <div class="kanban-column-header">
            <h3>ü§ù En Negociaci√≥n</h3>
            <span class="column-count">{{ getCotizacionesPorEstado('En Negociaci√≥n').length }}</span>
          </div>
          <div class="kanban-column-content">
            <app-quote-card 
              *ngFor="let cotizacion of getCotizacionesPorEstado('En Negociaci√≥n')"
              [cotizacion]="cotizacion"
              (estadoChanged)="onEstadoChanged($event)"
              (cotizacionDeleted)="onCotizacionDeleted($event)">
            </app-quote-card>
          </div>
        </div>
        
        <!-- Columna: Aceptada -->
        <div class="kanban-column">
          <div class="kanban-column-header">
            <h3>‚úÖ Aceptada</h3>
            <span class="column-count">{{ getCotizacionesPorEstado('Aceptada').length }}</span>
          </div>
          <div class="kanban-column-content">
            <app-quote-card 
              *ngFor="let cotizacion of getCotizacionesPorEstado('Aceptada')"
              [cotizacion]="cotizacion"
              (estadoChanged)="onEstadoChanged($event)"
              (cotizacionDeleted)="onCotizacionDeleted($event)">
            </app-quote-card>
          </div>
        </div>
        
        <!-- Columna: Rechazada -->
        <div class="kanban-column">
          <div class="kanban-column-header">
            <h3>‚ùå Rechazada</h3>
            <span class="column-count">{{ getCotizacionesPorEstado('Rechazada').length }}</span>
          </div>
          <div class="kanban-column-content">
            <app-quote-card 
              *ngFor="let cotizacion of getCotizacionesPorEstado('Rechazada')"
              [cotizacion]="cotizacion"
              (estadoChanged)="onEstadoChanged($event)"
              (cotizacionDeleted)="onCotizacionDeleted($event)">
            </app-quote-card>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
