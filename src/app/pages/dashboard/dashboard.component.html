<div class="dashboard-container">
  <app-header (logoutEvent)="onLogout()"></app-header>

  <main class="dashboard-main">
    <div class="dashboard-content">
      <!-- Título del Dashboard -->
      <div class="dashboard-header">
        <h1>📊 Panel de Control SUBE IA</h1>
        <p>Visión general del negocio y métricas clave para la toma de decisiones</p>
      </div>

      <!-- Indicador de carga -->
      <div *ngIf="cargando" class="loading-container">
        <div class="loading-spinner"></div>
        <p>Cargando datos del dashboard...</p>
      </div>

      <!-- Contenido principal cuando no está cargando -->
      <div *ngIf="!cargando" class="dashboard-content-main">
        <!-- Tarjetas de KPIs -->
        <div class="kpis-section">
          <h2 class="section-title">📈 Indicadores Clave de Rendimiento</h2>
          <div class="kpis-grid">
            <div class="kpi-card">
              <div class="kpi-icon">📋</div>
              <div class="kpi-content">
                <h3>Total Cotizaciones</h3>
                <p class="kpi-value">{{ kpis.totalCotizaciones }}</p>
                <span class="kpi-description">Cotizaciones generadas</span>
              </div>
            </div>
            
            <div class="kpi-card">
              <div class="kpi-icon">💰</div>
              <div class="kpi-content">
                <h3>Valor Total</h3>
                <p class="kpi-value">{{ formatearMoneda(kpis.valorTotalCotizaciones) }}</p>
                <span class="kpi-description">Valor de todas las cotizaciones</span>
              </div>
            </div>
            
            <div class="kpi-card">
              <div class="kpi-icon">✅</div>
              <div class="kpi-content">
                <h3>Contratos Cerrados</h3>
                <p class="kpi-value">{{ kpis.totalContratosCerrados }}</p>
                <span class="kpi-description">Contratos firmados</span>
              </div>
            </div>
            
            <div class="kpi-card">
              <div class="kpi-icon">📊</div>
              <div class="kpi-content">
                <h3>Tasa de Conversión</h3>
                <p class="kpi-value">{{ kpis.tasaConversion }}%</p>
                <span class="kpi-description">Aceptadas → Firmadas</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Gráficos -->
        <div class="charts-section">
          <h2 class="section-title">📊 Análisis de Datos</h2>
          
          <!-- Gráfico de Tendencia de Ventas -->
          <div class="chart-container">
            <div class="chart-header">
              <h3>📈 Tendencia de Ventas</h3>
              <p>Evolución mensual de cotizaciones aceptadas vs contratos firmados</p>
            </div>
            <div class="chart-wrapper">
              <canvas #tendenciasVentasChart></canvas>
            </div>
          </div>

          <!-- Gráfico de Rendimiento por Usuario -->
          <div class="chart-container">
            <div class="chart-header">
              <h3>👥 Rendimiento por Usuario</h3>
              <p>Cantidad de cotizaciones aceptadas por cada usuario</p>
            </div>
            <div class="chart-wrapper">
              <canvas #rendimientoUsuariosChart></canvas>
            </div>
          </div>

          <!-- Gráfico de Embudo de Ventas -->
          <div class="chart-container">
            <div class="chart-header">
              <h3>🎯 Embudo de Ventas</h3>
              <p>Distribución de cotizaciones por estado en el proceso de venta</p>
            </div>
            <div class="chart-wrapper">
              <canvas #embudoVentasChart></canvas>
            </div>
          </div>
        </div>

        <!-- Tarjetas de Navegación -->
        <div class="navigation-section">
          <h2 class="section-title">🚀 Acciones Rápidas</h2>
          <div class="navigation-cards">
            <!-- Gestión de Cotizaciones -->
            <div class="nav-card" routerLink="/cotizaciones">
              <div class="nav-card-icon">📊</div>
              <div class="nav-card-content">
                <h3>Gestión de Cotizaciones</h3>
                <p>Administra cotizaciones, estadísticas y filtros avanzados</p>
                <div class="nav-card-features">
                  <span class="feature">📋 Cotizaciones</span>
                  <span class="feature">📈 Estadísticas</span>
                  <span class="feature">🔍 Filtros</span>
                </div>
              </div>
              <div class="nav-card-arrow">→</div>
            </div>

            <!-- Gestión de Contratos -->
            <div class="nav-card" routerLink="/contratos">
              <div class="nav-card-icon">📄</div>
              <div class="nav-card-content">
                <h3>Gestión de Contratos</h3>
                <p>Administra contratos, firmas digitales y seguimiento</p>
                <div class="nav-card-features">
                  <span class="feature">📝 Contratos</span>
                  <span class="feature">✍️ Firmas</span>
                  <span class="feature">📊 Seguimiento</span>
                </div>
              </div>
              <div class="nav-card-arrow">→</div>
            </div>

            <!-- Crear Cotización -->
            <div class="nav-card" routerLink="/cotizaciones/crear">
              <div class="nav-card-icon">➕</div>
              <div class="nav-card-content">
                <h3>Crear Nueva Cotización</h3>
                <p>Genera cotizaciones personalizadas para clientes</p>
                <div class="nav-card-features">
                  <span class="feature">🎯 Personalizada</span>
                  <span class="feature">💰 Precios</span>
                  <span class="feature">📧 Envío</span>
                </div>
              </div>
              <div class="nav-card-arrow">→</div>
            </div>

            <!-- Configuración -->
            <div class="nav-card">
              <div class="nav-card-icon">⚙️</div>
              <div class="nav-card-content">
                <h3>Configuración</h3>
                <p>Configura el sistema y gestiona usuarios</p>
                <div class="nav-card-features">
                  <span class="feature">👥 Usuarios</span>
                  <span class="feature">🔧 Sistema</span>
                  <span class="feature">📊 Reportes</span>
                </div>
              </div>
              <div class="nav-card-arrow">→</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
