<div class="dashboard-container">
  <app-header (logoutEvent)="onLogout()"></app-header>

  <main class="dashboard-main">
    <div class="dashboard-content">
      <!-- T√≠tulo del Dashboard -->
      <div class="dashboard-header">
        <h1>üìä Panel de Control SUBE IA</h1>
        <p>Visi√≥n general del negocio y m√©tricas clave para la toma de decisiones</p>
      </div>

      <!-- Indicador de carga -->
      <div *ngIf="cargando" class="loading-container">
        <div class="loading-spinner"></div>
        <p>Cargando datos del dashboard...</p>
      </div>

      <!-- Indicador de error -->
      <div *ngIf="error" class="error-container">
        <div class="error-icon">‚ö†Ô∏è</div>
        <h3>Error al cargar datos</h3>
        <p>No se pudieron cargar los datos del dashboard. Int√©ntalo de nuevo.</p>
        <button class="btn btn-primary" (click)="recargarDatos()">
          üîÑ Recargar Datos
        </button>
      </div>

      <!-- Contenido principal cuando no est√° cargando -->
      <div *ngIf="!cargando && !error" class="dashboard-content-main">
        <!-- Tarjetas de KPIs -->
        <section class="kpis-section">
          <h2 class="section-title">üìà Indicadores Clave de Rendimiento</h2>
          <div class="kpis-grid">
            <div class="kpi-card">
              <div class="kpi-icon">üìã</div>
              <div class="kpi-content">
                <h3>Total Cotizaciones</h3>
                <p class="kpi-value">{{ kpis.totalCotizaciones }}</p>
                <span class="kpi-description">Cotizaciones generadas</span>
              </div>
            </div>
            
            <div class="kpi-card">
              <div class="kpi-icon">üí∞</div>
              <div class="kpi-content">
                <h3>Valor Total</h3>
                <p class="kpi-value">{{ formatearMoneda(kpis.valorTotalCotizaciones) }}</p>
                <span class="kpi-description">Valor de todas las cotizaciones</span>
              </div>
            </div>
            
            <div class="kpi-card">
              <div class="kpi-icon">‚úÖ</div>
              <div class="kpi-content">
                <h3>Contratos Cerrados</h3>
                <p class="kpi-value">{{ kpis.totalContratosCerrados }}</p>
                <span class="kpi-description">Contratos firmados</span>
              </div>
            </div>
            
            <div class="kpi-card">
              <div class="kpi-icon">üìä</div>
              <div class="kpi-content">
                <h3>Tasa de Conversi√≥n</h3>
                <p class="kpi-value">{{ kpis.tasaConversion }}%</p>
                <span class="kpi-description">Aceptadas ‚Üí Firmadas</span>
              </div>
            </div>

            <div class="kpi-card">
              <div class="kpi-icon">üéØ</div>
              <div class="kpi-content">
                <h3>Cotizaciones Aceptadas</h3>
                <p class="kpi-value">{{ kpis.cotizacionesAceptadas }}</p>
                <span class="kpi-description">Cotizaciones aprobadas</span>
              </div>
            </div>

            <div class="kpi-card">
              <div class="kpi-icon">‚è≥</div>
              <div class="kpi-content">
                <h3>Cotizaciones Pendientes</h3>
                <p class="kpi-value">{{ kpis.cotizacionesPendientes }}</p>
                <span class="kpi-description">En proceso de revisi√≥n</span>
              </div>
            </div>
          </div>
        </section>

        <!-- NUEVA SECCI√ìN: Indicadores Estrat√©gicos -->
        <section class="strategic-indicators-section">
          <h2 class="section-title">üéØ Indicadores Estrat√©gicos del Negocio</h2>
          
          <div class="strategic-indicators-grid">
            <!-- An√°lisis de Rentabilidad -->
            <div class="strategic-card">
              <div class="strategic-header">
                <div class="strategic-icon">üìä</div>
                <h3 class="strategic-title">An√°lisis de Rentabilidad</h3>
              </div>
              <div class="strategic-content">
                <div class="strategic-item">
                  <div class="strategic-item-label">Margen Promedio</div>
                  <div class="strategic-item-value">{{ indicadoresEstrategicos.margenPromedio }}%</div>
                  <div class="strategic-item-description">Margen de utilidad promedio</div>
                </div>
                <div class="strategic-item">
                  <div class="strategic-item-label">Servicio M√°s Rentable</div>
                  <div class="strategic-item-value">{{ indicadoresEstrategicos.rentabilidadPorServicio || 'N/A' }}</div>
                  <div class="strategic-item-description">Servicio con mayor valor</div>
                </div>
                <div class="strategic-item">
                  <div class="strategic-item-label">Costo de Adquisici√≥n</div>
                  <div class="strategic-item-value">{{ formatearMoneda(indicadoresEstrategicos.costoAcquisicion) }}</div>
                  <div class="strategic-item-description">Costo por cliente adquirido</div>
                </div>
              </div>
            </div>

            <!-- Eficiencia de Ventas -->
            <div class="strategic-card">
              <div class="strategic-header">
                <div class="strategic-icon">üéØ</div>
                <h3 class="strategic-title">Eficiencia de Ventas</h3>
              </div>
              <div class="strategic-content">
                <div class="strategic-item">
                  <div class="strategic-item-label">Tiempo Promedio Cierre</div>
                  <div class="strategic-item-value">{{ indicadoresEstrategicos.tiempoPromedioCierre }} d√≠as</div>
                  <div class="strategic-item-description">D√≠as para cerrar venta</div>
                </div>
                <div class="strategic-item">
                  <div class="strategic-item-label">Tasa de Rechazo</div>
                  <div class="strategic-item-value">{{ indicadoresEstrategicos.tasaRechazo }}%</div>
                  <div class="strategic-item-description">Cotizaciones rechazadas</div>
                </div>
                <div class="strategic-item">
                  <div class="strategic-item-label">Mejor Vendedor</div>
                  <div class="strategic-item-value">{{ indicadoresEstrategicos.eficienciaVendedor || 'N/A' }}</div>
                  <div class="strategic-item-description">Vendedor m√°s eficiente</div>
                </div>
              </div>
            </div>

            <!-- Tendencias de Crecimiento -->
            <div class="strategic-card">
              <div class="strategic-header">
                <div class="strategic-icon">üìà</div>
                <h3 class="strategic-title">Tendencias de Crecimiento</h3>
              </div>
              <div class="strategic-content">
                <div class="strategic-item">
                  <div class="strategic-item-label">Crecimiento Mensual</div>
                  <div class="strategic-item-value">{{ indicadoresEstrategicos.crecimientoMensual }}%</div>
                  <div class="strategic-item-description">vs mes anterior</div>
                </div>
                <div class="strategic-item">
                  <div class="strategic-item-label">Proyecci√≥n Trimestral</div>
                  <div class="strategic-item-value">{{ indicadoresEstrategicos.proyeccionTrimestral }}</div>
                  <div class="strategic-item-description">Cotizaciones esperadas</div>
                </div>
                <div class="strategic-item">
                  <div class="strategic-item-label">Estacionalidad</div>
                  <div class="strategic-item-value">{{ indicadoresEstrategicos.estacionalidad || 'N/A' }}</div>
                  <div class="strategic-item-description">Mes con mayor actividad</div>
                </div>
              </div>
            </div>

            <!-- Velocidad Operacional -->
            <div class="strategic-card">
              <div class="strategic-header">
                <div class="strategic-icon">‚ö°</div>
                <h3 class="strategic-title">Velocidad Operacional</h3>
              </div>
              <div class="strategic-content">
                <div class="strategic-item">
                  <div class="strategic-item-label">Tiempo de Respuesta</div>
                  <div class="strategic-item-value">{{ indicadoresEstrategicos.tiempoRespuesta }} hrs</div>
                  <div class="strategic-item-description">Respuesta promedio</div>
                </div>
                <div class="strategic-item">
                  <div class="strategic-item-label">Velocidad Procesamiento</div>
                  <div class="strategic-item-value">{{ indicadoresEstrategicos.velocidadProcesamiento }}/d√≠a</div>
                  <div class="strategic-item-description">Cotizaciones por d√≠a</div>
                </div>
                <div class="strategic-item">
                  <div class="strategic-item-label">Satisfacci√≥n Cliente</div>
                  <div class="strategic-item-value">{{ indicadoresEstrategicos.satisfaccionCliente }}%</div>
                  <div class="strategic-item-description">Tasa de satisfacci√≥n</div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Gr√°ficos -->
        <section class="charts-section">
          <h2 class="section-title">üìä An√°lisis de Datos</h2>
          
          <div class="charts-grid">
            <!-- Gr√°fico de Tendencia de Ventas -->
            <div class="chart-container">
              <div class="chart-header">
                <h3>üìà Tendencia de Ventas</h3>
                <p>Evoluci√≥n mensual de cotizaciones aceptadas vs contratos firmados</p>
              </div>
              <div class="chart-wrapper">
                <canvas #tendenciasVentasChart></canvas>
              </div>
            </div>

            <!-- Gr√°fico de Embudo de Ventas -->
            <div class="chart-container">
              <div class="chart-header">
                <h3>üéØ Embudo de Ventas</h3>
                <p>Distribuci√≥n de cotizaciones por estado en el proceso de venta</p>
              </div>
              <div class="chart-wrapper">
                <canvas #embudoVentasChart></canvas>
              </div>
            </div>

            <!-- Gr√°fico de Rendimiento por Usuario -->
            <div class="chart-container chart-full-width">
              <div class="chart-header">
                <h3>üë• Rendimiento por Usuario</h3>
                <p>Cantidad de cotizaciones aceptadas por cada usuario</p>
              </div>
              <div class="chart-wrapper">
                <canvas #rendimientoUsuariosChart></canvas>
              </div>
            </div>
          </div>
        </section>

        <!-- M√©tricas Adicionales -->
        <section class="metrics-section">
          <h2 class="section-title">üìã M√©tricas Detalladas del Negocio</h2>
          
          <div class="metrics-grid">
            <!-- M√©tricas de Servicios -->
            <div class="metric-card">
              <div class="metric-header">
                <div class="metric-icon">üõ†Ô∏è</div>
                <h3 class="metric-title">An√°lisis de Servicios</h3>
              </div>
              <div class="metric-content">
                <div class="metric-item">
                  <div class="metric-item-label">Servicios M√°s Vendidos</div>
                  <div class="metric-item-value">{{ metricasAdicionales.servicioMasVendido || 'N/A' }}</div>
                  <div class="metric-item-description">Servicio con m√°s cotizaciones</div>
                </div>
                <div class="metric-item">
                  <div class="metric-item-label">Valor Promedio</div>
                  <div class="metric-item-value">{{ formatearMoneda(metricasAdicionales.valorPromedio) }}</div>
                  <div class="metric-item-description">Promedio por cotizaci√≥n</div>
                </div>
                <div class="metric-item">
                  <div class="metric-item-label">Tiempo Promedio</div>
                  <div class="metric-item-value">{{ metricasAdicionales.tiempoPromedio || 'N/A' }}</div>
                  <div class="metric-item-description">D√≠as para cerrar</div>
                </div>
              </div>
            </div>

            <!-- M√©tricas de Clientes -->
            <div class="metric-card">
              <div class="metric-header">
                <div class="metric-icon">üë•</div>
                <h3 class="metric-title">An√°lisis de Clientes</h3>
              </div>
              <div class="metric-content">
                <div class="metric-item">
                  <div class="metric-item-label">Clientes Activos</div>
                  <div class="metric-item-value">{{ metricasAdicionales.clientesActivos }}</div>
                  <div class="metric-item-description">Clientes con cotizaciones</div>
                </div>
                <div class="metric-item">
                  <div class="metric-item-label">Cliente Top</div>
                  <div class="metric-item-value">{{ metricasAdicionales.clienteTop || 'N/A' }}</div>
                  <div class="metric-item-description">Mayor valor generado</div>
                </div>
                <div class="metric-item">
                  <div class="metric-item-label">Retenci√≥n</div>
                  <div class="metric-item-value">{{ metricasAdicionales.tasaRetencion }}%</div>
                  <div class="metric-item-description">Clientes recurrentes</div>
                </div>
              </div>
            </div>

            <!-- M√©tricas de Rendimiento -->
            <div class="metric-card">
              <div class="metric-header">
                <div class="metric-icon">üìà</div>
                <h3 class="metric-title">Rendimiento Operacional</h3>
              </div>
              <div class="metric-content">
                <div class="metric-item">
                  <div class="metric-item-label">Eficiencia</div>
                  <div class="metric-item-value">{{ metricasAdicionales.eficiencia }}%</div>
                  <div class="metric-item-description">Cotizaciones exitosas</div>
                </div>
                <div class="metric-item">
                  <div class="metric-item-label">Velocidad</div>
                  <div class="metric-item-value">{{ metricasAdicionales.velocidadPromedio || 'N/A' }}</div>
                  <div class="metric-item-description">D√≠as promedio</div>
                </div>
                <div class="metric-item">
                  <div class="metric-item-label">Crecimiento</div>
                  <div class="metric-item-value">{{ metricasAdicionales.tasaCrecimiento }}%</div>
                  <div class="metric-item-description">vs mes anterior</div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Tarjetas de Navegaci√≥n -->
        <section class="navigation-section">
          <h2 class="section-title">üöÄ Acciones R√°pidas</h2>
          <div class="navigation-cards">
            <!-- Gesti√≥n de Cotizaciones -->
            <div class="nav-card" routerLink="/cotizaciones">
              <div class="nav-card-icon">üìä</div>
              <div class="nav-card-content">
                <h3>Gesti√≥n de Cotizaciones</h3>
                <p>Administra cotizaciones, estad√≠sticas y filtros avanzados</p>
                <div class="nav-card-features">
                  <span class="feature">üìã Cotizaciones</span>
                  <span class="feature">üìà Estad√≠sticas</span>
                  <span class="feature">üîç Filtros</span>
                </div>
              </div>
              <div class="nav-card-arrow">‚Üí</div>
            </div>

            <!-- Gesti√≥n de Contratos -->
            <div class="nav-card" routerLink="/contratos">
              <div class="nav-card-icon">üìÑ</div>
              <div class="nav-card-content">
                <h3>Gesti√≥n de Contratos</h3>
                <p>Administra contratos, firmas digitales y seguimiento</p>
                <div class="nav-card-features">
                  <span class="feature">üìù Contratos</span>
                  <span class="feature">‚úçÔ∏è Firmas</span>
                  <span class="feature">üìä Seguimiento</span>
                </div>
              </div>
              <div class="nav-card-arrow">‚Üí</div>
            </div>

            <!-- Crear Cotizaci√≥n -->
            <div class="nav-card" routerLink="/cotizaciones/crear">
              <div class="nav-card-icon">‚ûï</div>
              <div class="nav-card-content">
                <h3>Crear Nueva Cotizaci√≥n</h3>
                <p>Genera cotizaciones personalizadas para clientes</p>
                <div class="nav-card-features">
                  <span class="feature">üéØ Personalizada</span>
                  <span class="feature">üí∞ Precios</span>
                  <span class="feature">üìß Env√≠o</span>
                </div>
              </div>
              <div class="nav-card-arrow">‚Üí</div>
            </div>

            <!-- Configuraci√≥n -->
            <div class="nav-card">
              <div class="nav-card-icon">‚öôÔ∏è</div>
              <div class="nav-card-content">
                <h3>Configuraci√≥n</h3>
                <p>Configura el sistema y gestiona usuarios</p>
                <div class="nav-card-features">
                  <span class="feature">üë• Usuarios</span>
                  <span class="feature">üîß Sistema</span>
                  <span class="feature">üìä Reportes</span>
                </div>
              </div>
              <div class="nav-card-arrow">‚Üí</div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </main>
</div>
