<div class="dashboard-container">
  <app-header (logoutEvent)="onLogout()"></app-header>

  <main class="dashboard-main">
    <div class="dashboard-content">
      <!-- TÃ­tulo del Dashboard -->
      <div class="dashboard-header">
        <h1>ğŸ“Š Panel de Control SUBE IA</h1>
        <p>VisiÃ³n general del negocio y mÃ©tricas clave para la toma de decisiones</p>
      </div>

      <!-- Indicador de carga -->
      <div *ngIf="cargando" class="loading-container">
        <div class="loading-spinner"></div>
        <p>Cargando datos del dashboard...</p>
      </div>

      <!-- Indicador de error -->
      <div *ngIf="error" class="error-container">
        <div class="error-icon">âš ï¸</div>
        <h3>Error al cargar datos</h3>
        <p>No se pudieron cargar los datos del dashboard. IntÃ©ntalo de nuevo.</p>
        <button class="btn btn-primary" (click)="recargarDatos()">
          ğŸ”„ Recargar Datos
        </button>
      </div>

      <!-- Contenido principal cuando no estÃ¡ cargando -->
      <div *ngIf="!cargando && !error" class="dashboard-content-main">
        <!-- Tarjetas de KPIs -->
        <section class="kpis-section">
          <h2 class="section-title">ğŸ“ˆ Indicadores Clave de Rendimiento</h2>
          <div class="kpis-grid">
            <div class="kpi-card">
              <div class="kpi-icon">ğŸ“‹</div>
              <div class="kpi-content">
                <h3>Total Cotizaciones</h3>
                <p class="kpi-value">{{ kpis.totalCotizaciones }}</p>
                <span class="kpi-description">Cotizaciones generadas</span>
              </div>
            </div>
            
            <div class="kpi-card">
              <div class="kpi-icon">ğŸ’°</div>
              <div class="kpi-content">
                <h3>Valor Total</h3>
                <p class="kpi-value">{{ formatearMoneda(kpis.valorTotalCotizaciones) }}</p>
                <span class="kpi-description">Valor de todas las cotizaciones</span>
              </div>
            </div>
            
            <div class="kpi-card">
              <div class="kpi-icon">âœ…</div>
              <div class="kpi-content">
                <h3>Contratos Cerrados</h3>
                <p class="kpi-value">{{ kpis.totalContratosCerrados }}</p>
                <span class="kpi-description">Contratos firmados</span>
              </div>
            </div>
            
            <div class="kpi-card">
              <div class="kpi-icon">ğŸ“Š</div>
              <div class="kpi-content">
                <h3>Tasa de ConversiÃ³n</h3>
                <p class="kpi-value">{{ kpis.tasaConversion }}%</p>
                <span class="kpi-description">Aceptadas â†’ Firmadas</span>
              </div>
            </div>

            <div class="kpi-card">
              <div class="kpi-icon">ğŸ¯</div>
              <div class="kpi-content">
                <h3>Cotizaciones Aceptadas</h3>
                <p class="kpi-value">{{ kpis.cotizacionesAceptadas }}</p>
                <span class="kpi-description">Cotizaciones aprobadas</span>
              </div>
            </div>

            <div class="kpi-card">
              <div class="kpi-icon">â³</div>
              <div class="kpi-content">
                <h3>Cotizaciones Pendientes</h3>
                <p class="kpi-value">{{ kpis.cotizacionesPendientes }}</p>
                <span class="kpi-description">En proceso de revisiÃ³n</span>
              </div>
            </div>
          </div>
        </section>

        <!-- NUEVA SECCIÃ“N: Indicadores EstratÃ©gicos -->
        <section class="strategic-indicators-section">
          <h2 class="section-title">ğŸ¯ Indicadores EstratÃ©gicos del Negocio</h2>
          
          <div class="strategic-indicators-grid">
            <!-- AnÃ¡lisis de Rentabilidad -->
            <div class="strategic-card">
              <div class="strategic-header">
                <div class="strategic-icon">ğŸ“Š</div>
                <h3 class="strategic-title">AnÃ¡lisis de Rentabilidad</h3>
              </div>
              <div class="strategic-content">
                <div class="strategic-item">
                  <div class="strategic-item-label">Margen Promedio</div>
                  <div class="strategic-item-value">{{ indicadoresEstrategicos.margenPromedio }}%</div>
                  <div class="strategic-item-description">Margen de utilidad promedio</div>
                </div>
                <div class="strategic-item">
                  <div class="strategic-item-label">Servicio MÃ¡s Rentable</div>
                  <div class="strategic-item-value">{{ indicadoresEstrategicos.rentabilidadPorServicio || 'N/A' }}</div>
                  <div class="strategic-item-description">Servicio con mayor valor</div>
                </div>
                <div class="strategic-item">
                  <div class="strategic-item-label">Costo de AdquisiciÃ³n</div>
                  <div class="strategic-item-value">{{ formatearMoneda(indicadoresEstrategicos.costoAcquisicion) }}</div>
                  <div class="strategic-item-description">Costo por cliente adquirido</div>
                </div>
              </div>
            </div>

            <!-- Eficiencia de Ventas -->
            <div class="strategic-card">
              <div class="strategic-header">
                <div class="strategic-icon">ğŸ¯</div>
                <h3 class="strategic-title">Eficiencia de Ventas</h3>
              </div>
              <div class="strategic-content">
                <div class="strategic-item">
                  <div class="strategic-item-label">Tiempo Promedio Cierre</div>
                  <div class="strategic-item-value">{{ indicadoresEstrategicos.tiempoPromedioCierre }} dÃ­as</div>
                  <div class="strategic-item-description">DÃ­as para cerrar venta</div>
                </div>
                <div class="strategic-item">
                  <div class="strategic-item-label">Tasa de Rechazo</div>
                  <div class="strategic-item-value">{{ indicadoresEstrategicos.tasaRechazo }}%</div>
                  <div class="strategic-item-description">Cotizaciones rechazadas</div>
                </div>
                <div class="strategic-item">
                  <div class="strategic-item-label">Mejor Vendedor</div>
                  <div class="strategic-item-value">{{ indicadoresEstrategicos.eficienciaVendedor || 'N/A' }}</div>
                  <div class="strategic-item-description">Vendedor mÃ¡s eficiente</div>
                </div>
              </div>
            </div>

            <!-- Tendencias de Crecimiento -->
            <div class="strategic-card">
              <div class="strategic-header">
                <div class="strategic-icon">ğŸ“ˆ</div>
                <h3 class="strategic-title">Tendencias de Crecimiento</h3>
              </div>
              <div class="strategic-content">
                <div class="strategic-item">
                  <div class="strategic-item-label">Crecimiento Mensual</div>
                  <div class="strategic-item-value">{{ indicadoresEstrategicos.crecimientoMensual }}%</div>
                  <div class="strategic-item-description">vs mes anterior</div>
                </div>
                <div class="strategic-item">
                  <div class="strategic-item-label">ProyecciÃ³n Trimestral</div>
                  <div class="strategic-item-value">{{ indicadoresEstrategicos.proyeccionTrimestral }}</div>
                  <div class="strategic-item-description">Cotizaciones esperadas</div>
                </div>
                <div class="strategic-item">
                  <div class="strategic-item-label">Estacionalidad</div>
                  <div class="strategic-item-value">{{ indicadoresEstrategicos.estacionalidad || 'N/A' }}</div>
                  <div class="strategic-item-description">Mes con mayor actividad</div>
                </div>
              </div>
            </div>

            <!-- Velocidad Operacional -->
            <div class="strategic-card">
              <div class="strategic-header">
                <div class="strategic-icon">âš¡</div>
                <h3 class="strategic-title">Velocidad Operacional</h3>
              </div>
              <div class="strategic-content">
                <div class="strategic-item">
                  <div class="strategic-item-label">Tiempo de Respuesta</div>
                  <div class="strategic-item-value">{{ indicadoresEstrategicos.tiempoRespuesta }} hrs</div>
                  <div class="strategic-item-description">Respuesta promedio</div>
                </div>
                <div class="strategic-item">
                  <div class="strategic-item-label">Velocidad Procesamiento</div>
                  <div class="strategic-item-value">{{ indicadoresEstrategicos.velocidadProcesamiento }}/dÃ­a</div>
                  <div class="strategic-item-description">Cotizaciones por dÃ­a</div>
                </div>
                <div class="strategic-item">
                  <div class="strategic-item-label">SatisfacciÃ³n Cliente</div>
                  <div class="strategic-item-value">{{ indicadoresEstrategicos.satisfaccionCliente }}%</div>
                  <div class="strategic-item-description">Tasa de satisfacciÃ³n</div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- GrÃ¡ficos -->
        <section class="charts-section">
          <h2 class="section-title">ğŸ“Š AnÃ¡lisis de Datos</h2>
          
          <div class="charts-grid">
            <!-- GrÃ¡fico de Tendencia de Ventas -->
            <div class="chart-container">
              <div class="chart-header">
                <h3>ğŸ“ˆ Tendencia de Ventas</h3>
                <p>EvoluciÃ³n mensual de cotizaciones aceptadas vs contratos firmados</p>
              </div>
              <div class="chart-wrapper">
                <canvas #tendenciasVentasChart></canvas>
              </div>
            </div>

            <!-- GrÃ¡fico de Embudo de Ventas -->
            <div class="chart-container">
              <div class="chart-header">
                <h3>ğŸ¯ Embudo de Ventas</h3>
                <p>DistribuciÃ³n de cotizaciones por estado en el proceso de venta</p>
              </div>
              <div class="chart-wrapper">
                <canvas #embudoVentasChart></canvas>
              </div>
            </div>

            <!-- GrÃ¡fico de Rendimiento por Usuario -->
            <div class="chart-container chart-full-width">
              <div class="chart-header">
                <h3>ğŸ‘¥ Rendimiento por Usuario</h3>
                <p>Cantidad de cotizaciones aceptadas por cada usuario</p>
              </div>
              <div class="chart-wrapper">
                <canvas #rendimientoUsuariosChart></canvas>
              </div>
            </div>
          </div>
        </section>

        <!-- MÃ©tricas Adicionales -->
        <section class="metrics-section">
          <h2 class="section-title">ğŸ“‹ MÃ©tricas Detalladas del Negocio</h2>
          
          <div class="metrics-grid">
            <!-- MÃ©tricas de Servicios -->
            <div class="metric-card">
              <div class="metric-header">
                <div class="metric-icon">ğŸ› ï¸</div>
                <h3 class="metric-title">AnÃ¡lisis de Servicios</h3>
              </div>
              <div class="metric-content">
                <div class="metric-item">
                  <div class="metric-item-label">Servicios MÃ¡s Vendidos</div>
                  <div class="metric-item-value">{{ metricasAdicionales.servicioMasVendido || 'N/A' }}</div>
                  <div class="metric-item-description">Servicio con mÃ¡s cotizaciones</div>
                </div>
                <div class="metric-item">
                  <div class="metric-item-label">Valor Promedio</div>
                  <div class="metric-item-value">{{ formatearMoneda(metricasAdicionales.valorPromedio) }}</div>
                  <div class="metric-item-description">Promedio por cotizaciÃ³n</div>
                </div>
                <div class="metric-item">
                  <div class="metric-item-label">Tiempo Promedio</div>
                  <div class="metric-item-value">{{ metricasAdicionales.tiempoPromedio || 'N/A' }}</div>
                  <div class="metric-item-description">DÃ­as para cerrar</div>
                </div>
              </div>
            </div>

            <!-- MÃ©tricas de Clientes -->
            <div class="metric-card">
              <div class="metric-header">
                <div class="metric-icon">ğŸ‘¥</div>
                <h3 class="metric-title">AnÃ¡lisis de Clientes</h3>
              </div>
              <div class="metric-content">
                <div class="metric-item">
                  <div class="metric-item-label">Clientes Activos</div>
                  <div class="metric-item-value">{{ metricasAdicionales.clientesActivos }}</div>
                  <div class="metric-item-description">Clientes con cotizaciones</div>
                </div>
                <div class="metric-item">
                  <div class="metric-item-label">Cliente Top</div>
                  <div class="metric-item-value">{{ metricasAdicionales.clienteTop || 'N/A' }}</div>
                  <div class="metric-item-description">Mayor valor generado</div>
                </div>
                <div class="metric-item">
                  <div class="metric-item-label">RetenciÃ³n</div>
                  <div class="metric-item-value">{{ metricasAdicionales.tasaRetencion }}%</div>
                  <div class="metric-item-description">Clientes recurrentes</div>
                </div>
              </div>
            </div>

            <!-- MÃ©tricas de Rendimiento -->
            <div class="metric-card">
              <div class="metric-header">
                <div class="metric-icon">ğŸ“ˆ</div>
                <h3 class="metric-title">Rendimiento Operacional</h3>
              </div>
              <div class="metric-content">
                <div class="metric-item">
                  <div class="metric-item-label">Eficiencia</div>
                  <div class="metric-item-value">{{ metricasAdicionales.eficiencia }}%</div>
                  <div class="metric-item-description">Cotizaciones exitosas</div>
                </div>
                <div class="metric-item">
                  <div class="metric-item-label">Velocidad</div>
                  <div class="metric-item-value">{{ metricasAdicionales.velocidadPromedio || 'N/A' }}</div>
                  <div class="metric-item-description">DÃ­as promedio</div>
                </div>
                <div class="metric-item">
                  <div class="metric-item-label">Crecimiento</div>
                  <div class="metric-item-value">{{ metricasAdicionales.tasaCrecimiento }}%</div>
                  <div class="metric-item-description">vs mes anterior</div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Tarjetas de NavegaciÃ³n -->
        <section class="navigation-section">
          <h2 class="section-title">ğŸš€ Acciones RÃ¡pidas</h2>
          <div class="navigation-cards">
            <!-- GestiÃ³n de Cotizaciones -->
            <div class="nav-card" routerLink="/cotizaciones">
              <div class="nav-card-icon">ğŸ“Š</div>
              <div class="nav-card-content">
                <h3>GestiÃ³n de Cotizaciones</h3>
                <p>Administra cotizaciones, estadÃ­sticas y filtros avanzados</p>
                <div class="nav-card-features">
                  <span class="feature">ğŸ“‹ Cotizaciones</span>
                  <span class="feature">ğŸ“ˆ EstadÃ­sticas</span>
                  <span class="feature">ğŸ” Filtros</span>
                </div>
              </div>
              <div class="nav-card-arrow">â†’</div>
            </div>

            <!-- GestiÃ³n de Contratos -->
            <div class="nav-card" routerLink="/contratos">
              <div class="nav-card-icon">ğŸ“„</div>
              <div class="nav-card-content">
                <h3>GestiÃ³n de Contratos</h3>
                <p>Administra contratos, firmas digitales y seguimiento</p>
                <div class="nav-card-features">
                  <span class="feature">ğŸ“ Contratos</span>
                  <span class="feature">âœï¸ Firmas</span>
                  <span class="feature">ğŸ“Š Seguimiento</span>
                </div>
              </div>
              <div class="nav-card-arrow">â†’</div>
            </div>

            <!-- Crear CotizaciÃ³n -->
            <div class="nav-card" routerLink="/cotizaciones/crear">
              <div class="nav-card-icon">â•</div>
              <div class="nav-card-content">
                <h3>Crear Nueva CotizaciÃ³n</h3>
                <p>Genera cotizaciones personalizadas para clientes</p>
                <div class="nav-card-features">
                  <span class="feature">ğŸ¯ Personalizada</span>
                  <span class="feature">ğŸ’° Precios</span>
                  <span class="feature">ğŸ“§ EnvÃ­o</span>
                </div>
              </div>
              <div class="nav-card-arrow">â†’</div>
            </div>

            <!-- ConfiguraciÃ³n -->
            <div class="nav-card">
              <div class="nav-card-icon">âš™ï¸</div>
              <div class="nav-card-content">
                <h3>ConfiguraciÃ³n</h3>
                <p>Configura el sistema y gestiona usuarios</p>
                <div class="nav-card-features">
                  <span class="feature">ğŸ‘¥ Usuarios</span>
                  <span class="feature">ğŸ”§ Sistema</span>
                  <span class="feature">ğŸ“Š Reportes</span>
                </div>
              </div>
              <div class="nav-card-arrow">â†’</div>
            </div>
          </div>
        </section>
      </div>
    </div>
  </main>
</div>
