<!-- Loading -->
<div *ngIf="loading" class="loading">
  <div>Cargando contrato...</div>
</div>

<!-- Error -->
<div *ngIf="error" class="error">
  {{ errorMessage }}
</div>

<!-- Mensaje de Ã©xito -->
<div *ngIf="mostrandoExito" class="success-message">
  <h3>âœ… Contrato Firmado Exitosamente</h3>
  <p>Su firma ha sido registrada correctamente. RecibirÃ¡ una copia del contrato firmado en su email.</p>
  
  <div class="success-actions">
    <h4>Â¿QuÃ© sigue?</h4>
    <p>Gracias por confiar en SUBE IA. Le invitamos a conocer mÃ¡s sobre nuestros servicios:</p>
    
    <div class="success-buttons">
      <a href="https://www.subeia.tech" target="_blank" class="btn btn-primary">
        ğŸŒ Visitar Nuestra Web
      </a>
      <a href="https://blog.subeia.tech" target="_blank" class="btn btn-secondary">
        ğŸ“ Ver Nuestro Blog
      </a>
    </div>
    
    <p class="success-note">
      <small>RecibirÃ¡ una copia del contrato firmado en su email en los prÃ³ximos minutos.</small>
    </p>
  </div>
</div>

<!-- Contenido principal -->
<div *ngIf="!loading && !error && !mostrandoExito && contrato" class="container">
  <!-- Header -->
  <div class="header">
    <div class="logo">
      <div class="logo-icon">ğŸ¤</div>
      <div class="logo-text">SUBE IA TECH</div>
    </div>
    <h1 class="subtitle">Firma Digital de Contrato</h1>
    <p>Complete su firma de manera segura y digital</p>
  </div>

  <!-- Contenido principal -->
  <div class="main-content">
    <!-- Resumen del contrato -->
    <div class="contrato-resumen">
      <h2>ğŸ“‹ Resumen del Contrato</h2>
      
      <div class="detalle-seccion">
        <h4>ğŸ“‹ InformaciÃ³n General</h4>
        <p><strong>TÃ­tulo:</strong> {{ contrato.tituloContrato || contrato.titulo || 'Sin tÃ­tulo' }}</p>
        <p><strong>CÃ³digo:</strong> {{ contrato.codigoCotizacion || contrato.codigo || 'Sin cÃ³digo' }}</p>
        <p><strong>Estado:</strong> 
          <span class="estado-badge" [ngClass]="getEstadoClass(contrato.estadoContrato)">
            {{ contrato.estadoContrato || 'Pendiente de Firma' }}
          </span>
        </p>
        <p><strong>Fecha de CreaciÃ³n:</strong> {{ formatearFecha(contrato.fechaCreacionContrato) }}</p>
      </div>
      
      <div class="detalle-seccion">
        <h4>ğŸ‘¤ InformaciÃ³n del Cliente</h4>
        <p><strong>Nombre:</strong> {{ contrato.cliente?.nombre || contrato.nombreCliente || 'No especificado' }}</p>
        <p><strong>Email:</strong> {{ contrato.cliente?.email || contrato.emailCliente || 'No especificado' }}</p>
        <p><strong>RUT:</strong> {{ contrato.cliente?.rut || contrato.rutCliente || 'No especificado' }}</p>
        <p><strong>Empresa:</strong> {{ contrato.cliente?.empresa || contrato.empresa || 'No especificada' }}</p>
      </div>
      
      <div class="detalle-seccion">
        <h4>ğŸ’° InformaciÃ³n Financiera</h4>
        <p><strong>Valor Total:</strong> ${{ (contrato.totalConDescuento || contrato.valorTotal || contrato.total || 0).toLocaleString() }}</p>
        <p *ngIf="contrato.descuento > 0"><strong>Descuento:</strong> {{ contrato.descuento }}%</p>
        <p><strong>Atendido por:</strong> {{ contrato.atendido || 'No especificado' }}</p>
      </div>
      
      <div class="detalle-seccion" *ngIf="contrato.partesInvolucradas">
        <h4>ğŸ¤ Partes Involucradas</h4>
        <p>{{ contrato.partesInvolucradas }}</p>
      </div>
      
      <div class="detalle-seccion" *ngIf="contrato.objetoContrato">
        <h4>ğŸ“„ Objeto del Contrato</h4>
        <p>{{ contrato.objetoContrato }}</p>
      </div>
      
      <div class="detalle-seccion" *ngIf="contrato.clausulas">
        <h4>ğŸ“œ ClÃ¡usulas y TÃ©rminos</h4>
        <p>{{ contrato.clausulas }}</p>
      </div>
      
      <div class="detalle-seccion" *ngIf="contrato.fechaInicio || contrato.fechaFin">
        <h4>ğŸ“… Fechas del Contrato</h4>
        <p *ngIf="contrato.fechaInicio"><strong>Fecha de Inicio:</strong> {{ formatearFecha(contrato.fechaInicio) }}</p>
        <p *ngIf="contrato.fechaFin"><strong>Fecha de Fin:</strong> {{ formatearFecha(contrato.fechaFin) }}</p>
      </div>
    </div>
    
    <!-- Ãrea de firma -->
    <div class="firma-section">
      <h3>âœï¸ Firma Digital</h3>
      <div class="firma-info">
        Por favor, firme en el Ã¡rea de abajo para completar el proceso de firma digital
      </div>
      
      <div class="cliente-info">
        <p><strong>Cliente:</strong> {{ contrato.cliente?.nombre || contrato.nombreCliente || 'No especificado' }}</p>
        <p><strong>Empresa:</strong> {{ contrato.cliente?.empresa || contrato.empresa || 'No especificada' }}</p>
      </div>
      
      <div class="canvas-container">
        <canvas #firmaClienteCanvas width="600" height="200"></canvas>
      </div>
      
      <div class="firma-actions">
        <button (click)="limpiarFirma()" class="btn btn-secondary">ğŸ§¹ Limpiar Firma</button>
        <button (click)="firmarContrato()" class="btn btn-primary">âœï¸ Firmar Contrato</button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <p>Â© 2024 SUBE IA TECH. Todos los derechos reservados.</p>
    <p>Sistema de firma digital seguro y confiable</p>
  </div>
</div> 